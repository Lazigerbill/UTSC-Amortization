
<div class="container">
	<div class="row">
		<div class="page-header">
			<h1>
				<i class="fa fa-calculator"></i>
				Mortgage Calculator
				<small>a UTSC demonstration</small>
			</h1>
		</div>
	</div>
<br>
<h3>Calculating the Payment Amount per Period</h3>
<%= image_tag 'Amortization-Formular.gif' %> <br>
<ul>
	<li>A = payment Amount per period</li>
	<li>P = initial Principal</li>
	<li>r = interest rate per period</li>
	<li>n = total number of payments</li>
</ul>

<p>Canadian Mortgage compounds semi-annually!!!</p>
<h3>Calculating the Rate Per Period</h3>
<%= image_tag 'cal_rate.gif' %>
<ul>
	<li>r = rate per payment period</li>
	<li>i = nominal annual interest rate</li>
	<li>n = number of compounding periods per year</li>
	<li>p = number of payment periods per year</li>
</ul>


<%= form_tag do %>
<div class="form-group">
	<%= label_tag :loan_amount %>
	<div class="input-group">
		<span class="input-group-addon">$</span>
		<%= text_field_tag :loan_amount, 20000, 'ng-model'=>'loanAmount', :class=>'form-control' %> 
	</div>
</div>

<div class="form-group">
	<%= label_tag :annual_interest_rate %>
	<div class="input-group">
		<%= text_field_tag :annual_interest_rate, nil, 'ng-model'=>'annualInterestRate', :class=>'form-control' %> 
		<span class="input-group-addon">%</span>
	</div>
	<%= range_field_tag :annual_interest_rate, nil, 'ng-model'=>'annualInterestRate', 'ng-change'=>'createTable()', :min=>0, :max=>20, :step=>0.01 %>
</div>

<p>Usually, the interest rate that you enter into an amortization calculator is the nominal annual rate. However, when creating an amortization schedule, it is the interest rate per period that you use in the calculations, labeled rate per period in the above spreadsheet.</p>

<div class="form-group">
	<%= label_tag :term_of_loan %>
	<div class="input-group">
		<%= text_field_tag :term_of_loan, nil, 'ng-model'=>'termOfLoan', :class=>'form-control', :placeholder=>'Please enter number of years' %>
		<span class="input-group-addon">Years</span>
	</div>	
	<%= range_field_tag :term_of_loan, nil, 'ng-model'=>'termOfLoan', 'ng-change'=>'createTable()', :min=>1, :max=>50, :step=>1 %>
</div>

<div class="form-group">
	<%= label_tag :first_payment_date %>
	<%= date_field_tag :first_payment_date, nil, 'ng-model'=>'firstPaymentDate', :class=>'form-control' %>
</div>

<div class="form-group">
		<i class="fa fa-info-circle has-popover" data-container="body" data-toggle="popover" data-placement="top" title="Payment Frequency" data-content="Basic amortization calculators usually assume that the payment frequency matches the compounding period. In that case, the rate per period is simply the nominal annual interest rate divided by the number of periods per year. When the compound period and payment period are different (as in Canadian mortgages), a more general formula is needed."></i>
		<%= label_tag :payment_frequency %> <br>
		<%= radio_button_tag(:payment_frequency, 24, nil,'ng-model'=>'paymentFrequency', 'ng-change'=>'createTable()') %>
		<%= label_tag(:payment_frequency, "Bi-weekly") %>
		<%= radio_button_tag(:payment_frequency, 12, nil, 'ng-model'=>'paymentFrequency', 'ng-change'=>'createTable()') %>
		<%= label_tag(:payment_frequency, "Monthly") %>
		<%= radio_button_tag(:payment_frequency, 6, nil, 'ng-model'=>'paymentFrequency', 'ng-change'=>'createTable()') %>
		<%= label_tag(:payment_frequency, "Semi-annually") %>
		<%= radio_button_tag(:payment_frequency, 1, nil, 'ng-model'=>'paymentFrequency', 'ng-change'=>'createTable()') %>
		<%= label_tag(:payment_frequency, "Annually") %>
		<br>

	</div>

	<div class="form-group">
		<i class="fa fa-info-circle has-popover" data-container="body" data-toggle="popover" data-placement="top" title="Compound Period" data-content="Basic amortization calculators usually assume that the payment frequency matches the compounding period. In that case, the rate per period is simply the nominal annual interest rate divided by the number of periods per year. When the compound period and payment period are different (as in Canadian mortgages), a more general formula is needed."></i>
		
		<%= label_tag :compound_period %> <br>
		<%= radio_button_tag(:compound_period, 24, nil,'ng-model'=>'compoundPeriod', 'ng-change'=>'createTable()') %>
		<%= label_tag(:compound_period, "Bi-weekly") %>
		<%= radio_button_tag(:compound_period, 12, nil, 'ng-model'=>'compoundPeriod', 'ng-change'=>'createTable()') %>
		<%= label_tag(:compound_period, "Monthly") %>
		<%= radio_button_tag(:compound_period, 6, nil, 'ng-model'=>'compoundPeriod', 'ng-change'=>'createTable()') %>
		<%= label_tag(:compound_period, "Semi-annually") %>
		<%= radio_button_tag(:compound_period, 1, nil, 'ng-model'=>'compoundPeriod', 'ng-change'=>'createTable()') %>
		<%= label_tag(:compound_period, "Annually") %>
	</div> 

	<%#= submit_tag 'Calculate', 'ng-model'=>'createTable()' %>
	<% end %>
	<!-- 	<button class="btn btn-default" ng-click="createTable()">Calculate</button> -->


	<h1>
		<i class="fa fa-clipboard"></i>
		Mortgage Summary
	</h1>
	<table class="table table-hover">
			<tr>
				<th>Number of payments:</th>
				<td><input type="text" value="{{getNumberOfPayments()}}", readonly="true"></td>
			</tr>
			<tr>
				<th>Rate (per period):</th>
				<td><input type="text" value="{{getRatePerPeriod()|number:6}}", readonly="true"></td>
			</tr>
			<tr>
				<th>Payment:</th>
				<td><input type="text" value="{{getPaymentPerPeriod()|currency:$:2}}", readonly="true"></td>
			</tr>
			<tr>
				<th>Total payment:</th>
				<td><input type="text" value="{{totalPayment|currency:$:2}}", readonly="true"></td>
			</tr>
			<tr>
				<th>Total interest:</th>
				<td><input type="text" value="{{totalInterest|currency:$:2}}", readonly="true"></td>
			</tr>
			<tr>
				<th>Last payment date:</th>
				<td><input type="text" value="{{paymentDate| date: 'MM/dd/yyyy'}}", readonly="true"></td>
			</tr>
	</table>

	<div id="pie" style="min-width: 300px; height: 320px; max-width: 500px"></div>

	<h1>Amortization table</h1>
	<table class="table table-condensed table-hover">
		<thead>	
			<tr>
				<th>Sequence</th>
				<th>Due date</th>
				<th>Payment Amount</th>
				<th>Interest</th>
				<th>Principal</th>
				<th>Balance</th>
			</tr>
		</thead>
		<tbody>	
			<tr ng-repeat="amortizationRow in amortizationRows">
				<td>{{amortizationRow.index}}</td>
				<td>{{amortizationRow.date| date: 'MM/dd/yyyy'}}</td>
				<td>{{amortizationRow.payment|currency:$:2}}</td>
				<td>{{amortizationRow.interest|currency:$:2}}</td>
				<td>{{amortizationRow.principal|currency:$:2}}</td>
				<td>{{amortizationRow.balance|currency:$:2}}</td>
			</tr>
		</tbody>
	</table>

	<div id="container" style="width:100%; height:400px;">

	</div>



